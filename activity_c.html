<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تحليل الكلمات</title>

  <style>
    /* === استدعاء الخط العربي المخصص (حط الملف داخل fonts/HacenAlgeriaHd.ttf) === */
    @font-face {
      font-family: 'HacenAlgeriaHd';
      src: url('fonts/HacenAlgeriaHd.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    /* === إعدادات عامة للصفحة === */
    body {
      margin: 0; /* إزالة الهوامش الافتراضية */
      padding: 0;
      background-color: #cc99ff; /* نفس خلفيات الأنشطة السابقة */
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'HacenAlgeriaHd', Arial, sans-serif; /* استخدام الخط المخصص كافتراضي */
      text-align: center;
    }

    /* === الحاوية الأساسية للمربع الأبيض (المحتوى الرئيسي) === */
        /* الحاوية الأساسية للنشاط */
        .activity-container {
            width: 100%; /* ياخد العرض كله */
            max-width: 1000px; /* أقصى عرض */
            height: 80vh; /* ياخد أغلب طول الشاشة */
            max-height: 800px; /* أقصى ارتفاع */
            background: #ffffff; /* خلفية بيضاء */
            padding: 20px;
            border-radius: 15px; /* حواف ناعمة */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); /* ظل */
            position: relative; /* علشان نقدر نثبت عناصر داخله */
            display: flex;
            flex-direction: column; /* العناصر ترتيبها عمودي */
            align-items: center; 
            justify-content: space-around;
        }

    /* === صورة اسم النشاط (اللوجو) على يسار المربع وبزاوية ميلان === */
        /* صورة النشاط (اللوجو في الركن) */
        .activity-label {
            position: absolute;   /* ثابتة داخل الحاوية */
            top: 10px;            /* مسافة من فوق */
            left: -45px;          /* طالعة شوية برة ناحية الشمال */
            width: 180px;         /* عرض الصورة */
            height: auto;         /* الطول تلقائي */
            transform: rotate(-40deg); /* ميل الصورة */
            border-radius: 10px;  /* حواف ناعمة */
            padding: 5px;         /* مسافة داخلية صغيرة */
        }
    /* === زر العودة (هوم) ثابت أسفل يسار داخل المربع الأبيض === */
    .home-button {
      position: absolute;
      bottom: 20px; /* أسفل المربع */
      left: 20px;   /* أقصى اليسار داخل المربع */
      cursor: pointer;
      width: 60px;
      height: 60px;
      z-index: 20;  /* فوق باقي العناصر */
    }
    .home-button img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* === عرض الكلمة الحالية (عنوان/الكلمة التي سيحللها التلميذ) === */
    .word-display {
      font-size: 48px; /* حجم كبير واضح */
      font-weight: bold;
      color: #333;
      margin-top: 10px; /* مسافة من الأعلى */
    }

    /* === مربع التحليل: المكان الذي تُسقط فيه الحروف لتكوين الكلمة === */
    .analysis-area {
      width: 90%;
      max-width: 460px;
      min-height: 120px;
      background: white;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 56px;
      font-weight: bold;
      color: #0015fc;
      direction: rtl;
      flex-wrap: wrap;
      /* إطار بنفسجي سميك حول مربع التحليل (متناسق مع بقية الأنشطة) */
      border: 12px solid #cc66ff; /* غير السمك/اللون لو حابب */
    }

    /* === منطقة النتيجة (نجوم + رسالة نجاح) === */
    .result-area {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 18px;
    }
    .stars-left, .stars-right { display:flex; gap:5px; }
    .star { font-size: 25px; color: gold; display: none; }
    .success-text { font-size: 22px; color: green; font-weight: bold; display: none; }

    /* === شبكة الحروف (أزرار السحب) === */
    .letters {
      display: grid;
      grid-template-columns: repeat(10, 1fr); /* 10 أعمدة كما في النشاط الأول */
      gap: 15px;
      width: 90%;
      max-width: 700px;
      justify-content: center;
      direction: rtl;
    }

    .letter {
      width: 50px;
      height: 50px;
     background: #ff66ff; /* لون الخلفية */
      border-radius: 15px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:24px;
      font-weight:bold;
      color:white;
      cursor: grab;
      font-family: 'HacenAlgeriaHd', sans-serif; /* نفس الخط */
      transition: transform 0.15s ease;
      user-select: none;
    }
    .letter:active { cursor: grabbing; transform: scale(1.08); }

    /* عندما يتم وضع حرف في مربع التحليل نستخدم ستايل مختلف */
    .placed-letter {
      font-size: 48px;
      font-weight: bold;
    }

    /* تجاوب على أحجام الشاشات الصغيرة */
    @media (max-width: 600px) {
      .activity-label { width: 120px; height:120px; left:-35px; transform:rotate(-30deg); }
      .analysis-area { font-size: 36px; border-width: 8px; }
      .word-display { font-size: 36px; }
      .letter { width:44px; height:44px; font-size:20px; }
    }
  </style>
</head>
<body>

  <!-- ===== الحاوية الرئيسية للنشاط (المربع الأبيض) ===== -->
  <div class="activity-container">
    <!-- زر العودة للصفحة الرئيسية (هوم) — ثابت أسفل اليسار داخل المربع -->
    <a href="activities.html" class="home-button" title="العودة">
      <img src="images/home_back.png" alt="العودة للصفحة الرئيسية">
    </a>

    <!-- صورة اسم النشاط (اللوجو) — تأكد أن الملف images/actv_3.png موجود -->
    <img src="images/actv_3.png" alt="نشاط تحليل الكلمات" class="activity-label">

    <!-- عرض الكلمة الحالية -->
    <div class="word-display" id="wordDisplay" aria-live="polite"></div>

    <!-- مربع التحليل (هنا يسقط التلميذ الحروف بترتيبها) -->
    <div class="analysis-area" id="analysisArea" aria-label="منطقة تحليل الكلمة">
      <!-- سيظهر هنا الحروف التي تم اتهاؤها -->
    </div>

    <!-- منطقة النتيجة (نجوم + نص) -->
    <div class="result-area">
      <div class="stars-left" id="starsLeft">
        <div class="star">★</div>
        <div class="star">★</div>
        <div class="star">★</div>
      </div>
      <div class="success-text" id="successText">برافووو!</div>
      <div class="stars-right" id="starsRight">
        <div class="star">★</div>
        <div class="star">★</div>
        <div class="star">★</div>
      </div>
    </div>

    <!-- شبكة الحروف (قوائم الحروف القابلة للسحب) -->
    <div class="letters" id="lettersGrid" aria-label="قائمة الحروف"></div>
  </div>

  <script>
    /* ========== بيانات الكلمات والـ letters ========== */
    const words = [
      { word: "أسد", letters: ['أ','س','د'] },
      { word: "جزر", letters: ['ج','ز','ر'] },
      { word: "ولد", letters: ['و','ل','د'] },
      { word: "بنت", letters: ['ب','ن','ت'] },
      { word: "عنب", letters: ['ع','ن','ب'] },
      { word: "جمل", letters: ['ج','م','ل'] },
      { word: "زرع", letters: ['ز','ر','ع'] },
      { word: "سوق", letters: ['س','و','ق'] },
      { word: "طفل", letters: ['ط','ف','ل'] },
      { word: "فيل", letters: ['ف','ي','ل'] }
    ];

    const arabicLetters = ['أ','ب','ت','ث','ج','ح','خ','د','ذ','ر','ز','س','ش','ص','ض','ط','ظ','ع','غ','ف','ق','ك','ل','م','ن','ه','ة','و','ي'];

    /* متحولات حالة النشاط */
    let currentWordIndex = 0;
    let currentLetterIndex = 0; // أي حرف متوقع بعده
    let expectedLetters = [];
    let placedLetters = [];

    /* عند تحميل الصفحة: عرض سؤال/كلمة جديدة */
    document.addEventListener('DOMContentLoaded', () => {
      setupNewWord();
    });

    /* دالة لإظهار كلمة جديدة وتجهيز الأزرار */
    function setupNewWord() {
      // اختيار كلمة عشوائية
      currentWordIndex = Math.floor(Math.random() * words.length);
      expectedLetters = [...words[currentWordIndex].letters];
      currentLetterIndex = 0;
      placedLetters = [];

      // عرض الكلمة (يمكن إخفاء أو إظهار حسب تصميمك؛ هنا نعرضها كعنوان)
      document.getElementById('wordDisplay').textContent = words[currentWordIndex].word;

      // إفراغ منطقة التحليل وإخفاء النجوم والنص
      const analysis = document.getElementById('analysisArea');
      analysis.innerHTML = '';
      document.querySelectorAll('.star').forEach(s => s.style.display = 'none');
      document.getElementById('successText').style.display = 'none';

      // بناء شبكة الحروف (إعادة ملئ)
      const grid = document.getElementById('lettersGrid');
      grid.innerHTML = '';
      arabicLetters.forEach(letter => {
        const div = document.createElement('div');
        div.className = 'letter';
        div.textContent = letter;
        div.draggable = true;
        // حدث بداية السحب
        div.addEventListener('dragstart', dragStart);
        // دعم اللمس على الأجهزة التي لا تدعم السحب native (اختياري/محدود)
        div.addEventListener('touchstart', touchStart, {passive: true});
        grid.appendChild(div);
      });

      // تفعيل منطقة الإسقاط
      setupAnalysisDrop();
    }

    /* عند بدء سحب حرف */
    function dragStart(e) {
      e.dataTransfer.setData('text/plain', this.textContent);
      // لتوضيح السحب على المتصفحات
    }

    /* دعم لمس بسيط: نستخدم خاصية تتبع لمسات — (محدود ويفضل إضافة مكتبة للمستخدمين اللمس) */
    function touchStart(e) {
      // نعرض رسالة بسيطة أو نعمل سلوك بديل عند الحاجة — هنا لنفعل السحب نستخدم click fallback
    }

    /* إعداد منطقة التحليل لتقبل الإسقاط */
    function setupAnalysisDrop() {
      const dropArea = document.getElementById('analysisArea');

      // منع السلوك الافتراضي على dragover للسماح بالإسقاط
      dropArea.addEventListener('dragover', function(e) {
        e.preventDefault();
      });

      // التعامل مع حدث الإسقاط
      dropArea.addEventListener('drop', function(e) {
        e.preventDefault();
        const data = e.dataTransfer.getData('text/plain');
        if (!data) return; // لا يوجد حرف
        const droppedLetter = data.trim();

        // الحرف المتوقع
        const expected = expectedLetters[currentLetterIndex];

        if (droppedLetter === expected) {
          // حرف صحيح
          placedLetters.push(droppedLetter);
          currentLetterIndex++;

          // عرض الحروف التي تم وضعها داخل منطقة التحليل
          dropArea.textContent = placedLetters.join('');

          // تشغيل صوت صح (تأكد أن الملف موجود: sounds/correct.mp3)
          new Audio('sounds/correct.mp3').play().catch(()=>{});

          // إذا انتهت جميع الحروف
          if (currentLetterIndex >= expectedLetters.length) {
            // تشغيل صوت الكلمة الكاملة إن وُجد (مثال: sounds/word1.mp3 ...)
            new Audio(`sounds/word${currentWordIndex + 1}.mp3`).play().catch(()=>{});

            // إظهار النجوم ونص النجاح
            document.querySelectorAll('.star').forEach(s => s.style.display = 'inline');
            document.getElementById('successText').style.display = 'block';

            // بعد 2.5 ثانية نحمل كلمة جديدة
            setTimeout(setupNewWord, 2500);
          }
        } else {
          // حرف خطأ — ممكن تضيف تأثير بصري أو صوتي
          new Audio('sounds/wrong.mp3').play().catch(()=>{});
          // تأثير بصري مؤقت: تخبر المستخدم
        }
      });
    }

    /* منع قائمة السياق (كليك يمين) داخل النشاط */
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });
  </script>
</body>
</html>
