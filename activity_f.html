<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <title>النشاط السادس</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* 🔹 استدعاء الخط المخصص للنشاط */
        @font-face {
            font-family: 'NotoSansArabic_Condensed-Bold';
            src: url('fonts/NotoSansArabic_Condensed-Bold.ttf') format('truetype');
        }

        /* ===== إعدادات الجسم الأساسي ===== */
        body {
            margin: 0;
            padding: 0;
            background: url('images/back_a_img.png') no-repeat center center;
            background-size: cover;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'NotoSansArabic_Condensed-Bold', sans-serif;
            overflow: hidden;
        }

        /* ===== الحاوية الرئيسية للنشاط ===== */
        .activity-container {
            width: 100%;
            max-width: 1000px;
            height: 80vh;
            max-height: 800px;
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: row-reverse;
            /* العمود الجانبي على اليمين */
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        /* ===== العمود الجانبي ===== */
        .sidebar {
            width: 15%;
            /* العمود الجانبي يمثل 15% من النشاط */
            background: #f3e8ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            padding: 15px 5px;
            border-top-right-radius: 15px;
            border-bottom-right-radius: 15px;
            box-sizing: border-box;
            height: 100%;
        }

        .sidebar .row {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* ⭐ الصف 1: النجوم */
        .stars {
            direction: rtl;
            /* 👈 فرض الاتجاه من اليمين */
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 6px;
        }

        .stars img {
            width: 30px;
            height: 30px;
            transition: transform .25s ease, filter .25s ease;
        }

        .stars img:nth-child(2) {
            transform: translateY(-6px);
            /* رفع النجمة الوسطى لتنسيق جمالي */
        }

        /* ✍️ الصف 2: صورة الطالب */
        .child-photo img {
            width: 110px;
            height: auto;
            display: block;
            border-radius: 8px;
        }

        /* ✍️ الصف 3: اسم الطالب */

        .student-name {
            margin: 0;
            padding: 0;
            text-align: center;
        }

        .student-name p {
            margin: 0;
            font-size: 16px;
            font-weight: bold;
            background: #fff;
            border-radius: 12px;
            padding: 6px 12px;
            display: inline-block;

            /* ✅ منع الالتفاف على سطر جديد */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            /* يظهر ... إذا الاسم طويل جدًا */
        }

        /* ⏱️ الصف 4: المؤقت */
        .timer img {
            width: 70px;
            height: 70px;
            object-fit: contain;
        }

        /* 🏠🔄 الصف 5: التحكم (هوم وريست) */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            width: 100%;
            box-sizing: border-box;
        }

        .controls .right {
            order: 2;
            /* الهوم على اليمين */
        }

        .controls .left {
            order: 1;
            /* إعادة النشاط على اليسار */
        }

        .controls img {
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: transform 0.15s ease;
        }

        .controls img:hover {
            transform: scale(1.08);
        }

        /* ===== منطقة النشاط ===== */
        .content-area {
            width: 85%;
            /* 85% للنشاط نفسه */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            height: 100%;
            position: relative;
        }

        /* صورة النشاط */
        .activity-label {
            position: absolute;
            top: 10px;
            left: -45px;
            width: 180px;
            height: auto;
            transform: rotate(-40deg);
            border-radius: 10px;
            padding: 5px;
        }

        /* المربع بخلفية صورة */
        .image-box {
            width: 85%;
            max-width: 220px;
            height: 220px;
            background: url('images/back_img.png') no-repeat center center;
            background-size: cover;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-box img {
            max-width: 180px;
            max-height: 180px;
        }

        /* منطقة الكلمة الناقصة */
        .word-drop-zone {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70px;
            width: 90%;
            max-width: 400px;
            background: #ffffcc;
            border: 8px solid #ff9966;
            border-radius: 10px;
            padding: 10px;
            font-size: 45px;
            font-weight: bold;
            font-family: 'NotoSansArabic_Condensed-Bold', sans-serif;
            direction: rtl;
            color: #1505ee;
            transition: box-shadow 0.5s ease-in-out;
            cursor: pointer;
        }

        .missing-letter {
            display: inline-block;
            margin: 0 2px;
            font-family: 'NotoSansArabic_Condensed-Bold', sans-serif;
            color: red;
            /* الشرطة الحمراء لتمثيل الحرف الناقص */
            font-weight: bold;
            min-width: 30px;
            text-align: center;
        }

        /* شبكة الحروف */
        .letters-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            max-width: 635px;
            margin: 0 auto;
            direction: rtl;
        }

        /* الحروف القابلة للسحب */
        .letters-grid .letter {
            width: 50px;
            height: 50px;
            background: url('images/back_letter.png') no-repeat center center;
            background-size: cover;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            font-weight: bold;
            color: white;
            cursor: grab;
            font-family: 'NotoSansArabic_Condensed-Bold', sans-serif;
            transition: transform 0.2s ease, box-shadow 0.3s ease;
        }

        .letters-grid .letter:hover {
            transform: scale(1.1);
        }

        /* وميض النجاح عند الإجابة الصحيحة */
        .glowing-box {
            animation: correctGlow 1.5s ease-in-out 3;
        }

        @keyframes correctGlow {
            0% {
                box-shadow: 0 0 0 #4CAF50;
            }

            50% {
                box-shadow: 0 0 30px 10px #4CAF50;
            }

            100% {
                box-shadow: 0 0 0 #4CAF50;
            }
        }

        /* أيقونات المستويات داخل النشاط */
        .difficulty-options {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .difficulty-options img {
            width: 35px;
            height: 35px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .difficulty-options img:hover {
            transform: scale(1.1);
        }
    </style>
</head>

<body>
    <div class="activity-container">

        <!-- العمود الجانبي -->
        <div class="sidebar">
            <!-- ⭐ النجوم -->
            <div class="row stars">
                <img id="star1" src="images/star1.png" alt="نجمة 1">
                <img id="star2" src="images/star2.png" alt="نجمة 2">
                <img id="star3" src="images/star3.png" alt="نجمة 3">
            </div>

            <!-- صورة الطفل -->
            <div class="row child-photo">
                <img id="childPhoto" src="images/child_photo.png" alt="صورة الطفل"> <!-- ✅ إضافة id -->
            </div>
            <!-- اسم الطالب -->
            <div class="row student-name">
                <p id="studentName">أحمد محمد</p> <!-- ✅ إضافة id -->
            </div>



            <!-- المؤقت -->
            <div class="row timer">
                <img src="images/timer.png" alt="مؤقت">
            </div>

            <!-- أزرار التحكم -->
            <div class="row controls">
                <div class="right"><img id="homeBtn" src="images/home.png" alt="صفحة الأنشطة"></div>
                <div class="left"><img id="retryBtn" src="images/retry.png" alt="إعادة"></div>
            </div>
        </div>

        <!-- منطقة النشاط -->
        <div class="content-area">
            <!-- صورة النشاط -->
            <img src="images/actv_6.png" class="activity-label" alt="نشاط 6">

            <!-- المربع بخلفية صورة -->
            <div class="image-box" id="imageBox"></div>

            <!-- منطقة الكلمة الناقصة -->
            <div class="word-drop-zone" id="wordDropZone" data-correct-letter="" data-word=""></div>

            <!-- شبكة الحروف -->
            <div class="letters-grid" id="lettersGrid"></div>

            <!-- أيقونات المستويات داخل النشاط -->
            <div class="difficulty-options">
                <img src="images/letter_a.png" alt="المستوى الأول" onclick="setLevel(1)">
                <img src="images/letter_b.png" alt="المستوى الثاني" onclick="setLevel(2)">
                <img src="images/letter_c.png" alt="المستوى الثالث" onclick="setLevel(3)">
            </div>

            <!-- الأصوات -->
            <audio id="correctSound" src="sounds/correct.mp3"></audio>
            <audio id="wrongSound" src="sounds/wrong.mp3"></audio>
            <audio id="applauseSound" src="sounds/clap.mp3"></audio>
        </div>
    </div>

    <script>






        document.addEventListener('DOMContentLoaded', function () {
            // ✅ استرجاع البيانات من شاشة إدخال المستخدم
            const storedName = sessionStorage.getItem('userName');   // اسم المستخدم
            const storedImage = sessionStorage.getItem('userImage'); // صورة المستخدم (Base64)

            // ✅ عرض اسم المستخدم في العنصر المخصص له
            if (storedName) {
                const nameElement = document.getElementById('studentName');
                if (nameElement) {
                    nameElement.textContent = storedName;
                }
            }

            // ✅ عرض صورة المستخدم في العنصر المخصص لها
            if (storedImage) {
                const photoElement = document.getElementById('childPhoto');
                if (photoElement) {
                    photoElement.src = storedImage;
                }
            }

            // 💡 ملاحظة: هذا الجزء فقط يعرض الاسم والصورة
            // جميع وظائف النشاط الأخرى (الحروف، النجوم، الأصوات، المطابقة...) تبقى كما هي بدون أي تعديل
        });





        let currentLevel = 1; // المستوى الحالي
        let correctAnswers = 0; // عدد الإجابات الصحيحة
        let isWaiting = false;  // حالة الانتظار قبل الانتقال للكلمة التالية

        // ✅ كلمات المستوى 1
        const wordsLevel1 = [
            { id: 1, word: "فيل", missing: "ف", shaped: ["فـ", "يـ", "ل"] },
            { id: 2, word: "أسد", missing: "أ", shaped: ["أ", "سـ", "د"] },
            { id: 3, word: "قلم", missing: "ق", shaped: ["قـ", "لـ", "م"] },
            { id: 4, word: "مركب", missing: "م", shaped: ["مـ", "ر", "كـ", "ب"] },
            { id: 5, word: "نمر", missing: "ن", shaped: ["نـ", "مـ", "ر"] },
            { id: 6, word: "ديك", missing: "د", shaped: ["د", "يـ", "ك"] },
            { id: 7, word: "طائرة", missing: "ط", shaped: ["طـ", "ا", "ئ", "ر", "ة"] },
            { id: 8, word: "قمر", missing: "ق", shaped: ["قـ", "مـ", "ر"] },
            { id: 9, word: "سمكة", missing: "س", shaped: ["سـ", "مـ", "كـ", "ة"] },
            { id: 10, word: "فستان", missing: "ف", shaped: ["فـ", "سـ", "تـ", "ا", "ن"] }
        ];

        // ✅ كلمات المستوى 2
        const wordsLevel2 = [
            { id: 11, word: "قطة", missing: "ط", shaped: ["قـ", "طـ", "ـة"] },
            { id: 12, word: "كتاب", missing: "ت", shaped: ["كـ", "تـ", "ا", "ب"] },
            { id: 13, word: "بيت", missing: "ي", shaped: ["بـ", "يـ", "ت"] },
            { id: 14, word: "ولد", missing: "ل", shaped: ["و", "لـ", "د"] },
            { id: 15, word: "عنب", missing: "ن", shaped: ["عـ", "نـ", "ب"] },
            { id: 16, word: "جزر", missing: "ز", shaped: ["جـ", "ز", "ر"] },
            { id: 17, word: "تفاح", missing: "ف", shaped: ["تـ", "فـ", "ا", "ح"] },
            { id: 18, word: "موز", missing: "و", shaped: ["مـ", "و", "ز"] },
            { id: 19, word: "دب", missing: "ب", shaped: ["د", "ب"] },
            { id: 20, word: "رمان", missing: "م", shaped: ["ر", "مـ", "ا", "ن"] }
        ];

        // ✅ كلمات المستوى 3
        const wordsLevel3 = [
            { id: 21, word: "بنت", missing: "ت", shaped: ["بـ", "نـ", "ت"] },
            { id: 22, word: "أتوبيس", missing: "س", shaped: ["أ", "تـ", "و", "بـ", "يـ", "س"] },
            { id: 23, word: "حصان", missing: "ن", shaped: ["حـ", "صـ", "ا", "ن"] },
            { id: 24, word: "ضفدع", missing: "ع", shaped: ["ضـ", "فـ", "د", "ع"] },
            { id: 25, word: "طماطم", missing: "م", shaped: ["طـ", "مـ", "ا", "طـ", "م"] },
            { id: 26, word: "صندوق", missing: "ق", shaped: ["صـ", "نـ", "د", "و", "ق"] },
            { id: 27, word: "جمل", missing: "ل", shaped: ["جـ", "مـ", "ل"] },
            { id: 28, word: "لحم", missing: "م", shaped: ["لـ", "حـ", "م"] },
            { id: 29, word: "حوت", missing: "ت", shaped: ["حـ", "و", "ت"] },
            { id: 30, word: "خروف", missing: "ف", shaped: ["خـ", "ر", "و", "ف"] }
        ];

        // ✅ تعيين المستوى
        function setLevel(level) {
            currentLevel = level;
            startNewRound();
        }

        // ✅ الحصول على كلمات المستوى الحالي
        function getCurrentWords() {
            if (currentLevel === 1) return wordsLevel1;
            if (currentLevel === 2) return wordsLevel2;
            return wordsLevel3;
        }

        // ✅ خلط العناصر عشوائياً
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // ✅ بدء جولة جديدة
        function startNewRound() {
            if (isWaiting) return; // منع التحديث إذا نحن في الانتظار

            const words = getCurrentWords();
            const currentWord = words[Math.floor(Math.random() * words.length)];

            // عرض الصورة المناسبة للكلمة
            const imageBox = document.getElementById('imageBox');
            imageBox.innerHTML = `<img src="images/word_photo${currentWord.id}.png" alt="${currentWord.word}">`;

            const wordDropZone = document.getElementById('wordDropZone');
            wordDropZone.dataset.correctLetter = currentWord.missing;
            wordDropZone.dataset.word = currentWord.word;
            wordDropZone.classList.remove('glowing-box');

            // عرض الكلمة باستخدام الشرطة الحمراء
            const shapedWord = currentWord.shaped.map(ltr => {
                return (ltr.includes(currentWord.missing))
                    ? `<span class="missing-letter">ـ</span>`
                    : ltr;
            }).join("");
            wordDropZone.innerHTML = shapedWord;

            setupLetters(currentWord);
        }

        // ✅ إعداد شبكة الحروف
        function setupLetters(currentWord) {
            const lettersGrid = document.getElementById('lettersGrid');
            lettersGrid.innerHTML = '';

            const allLetters = ['ف', 'أ', 'ق', 'م', 'ن', 'د', 'ط', 'س', 'ب', 'ي', 'ل', 'ر', 'ئ', 'ة', 'ت', 'ك', 'ث', 'ج', 'ح', 'خ', 'ذ', 'ش', 'ص', 'ض', 'ظ', 'ع', 'غ', 'هـ', 'و'];
            const lettersToShow = new Set();
            lettersToShow.add(currentWord.missing);

            while (lettersToShow.size < 10) {
                const randomLetter = allLetters[Math.floor(Math.random() * allLetters.length)];
                lettersToShow.add(randomLetter);
            }

            const shuffledOptions = shuffle([...lettersToShow]);

            shuffledOptions.forEach(letter => {
                const div = document.createElement('div');
                div.className = 'letter';
                div.textContent = letter;
                div.draggable = true;
                div.id = `draggable-${letter}`;
                div.addEventListener('dragstart', dragStart);
                lettersGrid.appendChild(div);
            });
        }

        // ✅ بدء السحب
        function dragStart(event) {
            event.dataTransfer.setData('text/plain', event.target.textContent);
            event.dataTransfer.effectAllowed = 'move';
        }

        const dropZone = document.getElementById('wordDropZone');
        dropZone.addEventListener('dragover', e => { e.preventDefault(); });

        // ✅ التعامل مع إسقاط الحرف
        dropZone.addEventListener('drop', e => {
            e.preventDefault();
            if (isWaiting) return; // منع التفاعل أثناء الانتظار

            const droppedLetter = e.dataTransfer.getData('text/plain');
            const correctLetter = dropZone.dataset.correctLetter;
            const fullWord = dropZone.dataset.word;

            if (droppedLetter === correctLetter) {
                document.getElementById('correctSound').play().catch(() => { });
                correctAnswers++;       // زيادة عدد الإجابات الصحيحة
                updateStars();          // تحديث النجوم تلقائياً

                const draggedElement = document.getElementById(`draggable-${droppedLetter}`);
                if (draggedElement) draggedElement.style.visibility = 'hidden';
                dropZone.textContent = fullWord;
                dropZone.classList.add('glowing-box');

                isWaiting = true;       // منع أي تحديث آخر أثناء الانتظار
                setTimeout(() => {
                    isWaiting = false;
                    startNewRound();    // الانتقال للجولة التالية بعد 2 ثانية
                }, 2000);
            } else {
                document.getElementById('wrongSound').play().catch(() => { });
            }
        });



        // ⭐ دالة موحدة لتحريك النجوم
        function animateStar(starEl) {
            starEl.style.transform = 'translateX(15px) scale(1.25)'; // حركة من الشمال
            // 👆 لو عايز من اليمين بدل الشمال، غيّر -15px إلى 15px

            setTimeout(() => {
                starEl.style.transform = ''; // ترجع لمكانها الأصلي
            }, 250);
        }








        // ✅ تحديث النجوم حسب عدد الإجابات الصحيحة مع الحركة
        function updateStars() {
            if (correctAnswers === 3) {
                const star1 = document.getElementById('star1');
                star1.src = "images/star_red.png";
                animateStar(star1); // ⭐ تشغيل الحركة
            }
            if (correctAnswers === 6) {
                const star2 = document.getElementById('star2');
                star2.src = "images/star_red.png";
                animateStar(star2); // ⭐ تشغيل الحركة
            }
            if (correctAnswers === 9) {
                const star3 = document.getElementById('star3');
                star3.src = "images/star_red.png";
                animateStar(star3); // ⭐ تشغيل الحركة
            }
        }




        // ✅ إعادة النشاط وإعادة تعيين النجوم
        document.getElementById('retryBtn').addEventListener('click', () => {
            correctAnswers = 0;
            document.getElementById('star1').src = "images/star1.png";
            document.getElementById('star2').src = "images/star2.png";
            document.getElementById('star3').src = "images/star3.png";
            isWaiting = false;
            startNewRound();
        });

        // ✅ زر الهوم للعودة للأنشطة
        document.getElementById('homeBtn').addEventListener('click', () => {
            window.location.href = "activities.html";
        });

        document.addEventListener('DOMContentLoaded', startNewRound);

        // منع قائمة كليك يمين كما في النشاطات السابقة
        document.addEventListener('contextmenu', function (e) { e.preventDefault(); });
    </script>
</body>

</html>